[{"D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\index.js":"1","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\App.js":"2","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\store\\index.js":"3","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\component\\Drawer\\index.js":"4","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\component\\LeftToolBar\\index.js":"5","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\component\\Header\\index.js":"6","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\store\\reducer\\renderReducer.js":"7","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\componentlist.js":"8"},{"size":276,"mtime":1610103016110,"results":"9","hashOfConfig":"10"},{"size":383,"mtime":1610103016104,"results":"11","hashOfConfig":"10"},{"size":301,"mtime":1610103016111,"results":"12","hashOfConfig":"10"},{"size":9529,"mtime":1610109879029,"results":"13","hashOfConfig":"10"},{"size":775,"mtime":1610038635612,"results":"14","hashOfConfig":"10"},{"size":635,"mtime":1610108848677,"results":"15","hashOfConfig":"10"},{"size":5260,"mtime":1610128332202,"results":"16","hashOfConfig":"10"},{"size":899,"mtime":1610103016109,"results":"17","hashOfConfig":"10"},{"filePath":"18","messages":"19","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},"bsuf4o",{"filePath":"21","messages":"22","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"23","messages":"24","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"25","messages":"26","errorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"27","usedDeprecatedRules":"20"},{"filePath":"28","messages":"29","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"30","messages":"31","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"32","usedDeprecatedRules":"20"},{"filePath":"33","messages":"34","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"35","messages":"36","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},"D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\index.js",[],["37","38"],"D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\App.js",[],"D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\store\\index.js",[],"D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\component\\Drawer\\index.js",["39","40","41","42","43","44","45","46"],"import {useState,useCallback} from 'react';\r\nimport {useSelector,useDispatch} from 'react-redux'\r\n\r\nimport componentList from '../../componentlist';\r\nimport css from './index.module.css';\r\n//业务组件\r\nfunction Text(props){\r\n    return (\r\n        <div style={props.style}>{props.propV}</div>\r\n    )\r\n}\r\nfunction Button(props){\r\n    return (\r\n        <button style={props.style}>{props.propV}</button>\r\n    )\r\n}\r\nfunction Image(props){\r\n    return (\r\n        <img src={props.propV} style={props.style} alt='pic'/>\r\n    )\r\n}\r\n// window.Test = Test;\r\nfunction transformComp(strV){\r\n    let comp = null;\r\n    switch (strV){\r\n        case 'Text':comp = Text;break;\r\n        case 'Button':comp = Button;break;\r\n        case 'Image':comp = Image;break;\r\n        default:break;\r\n    }\r\n    return comp;\r\n}\r\n\r\nfunction dragOverHandle(e){\r\n    e.preventDefault();\r\n}\r\nconst pointList = ['t', 'r', 'b', 'l', 'lt', 'rt', 'lb', 'rb'];\r\nconst directionKey = {\r\n    t:'n',\r\n    b:'s',\r\n    r:'e',\r\n    l:'w',\r\n}\r\nfunction getPointStyle(point,defaultStyle) {\r\n    const { width, height } = defaultStyle\r\n    const hasT = /t/.test(point)\r\n    const hasB = /b/.test(point)\r\n    const hasL = /l/.test(point)\r\n    const hasR = /r/.test(point)\r\n    let newLeft = 0\r\n    let newTop = 0\r\n\r\n    // 四个角的点\r\n    if (point.length === 2) {\r\n        newLeft = hasL? 0 : width\r\n        newTop = hasT? 0 : height\r\n    } else {\r\n        // 上下两点的点，宽度居中\r\n        if (hasT || hasB) {\r\n            newLeft = width / 2\r\n            newTop = hasT? 0 : height\r\n        }\r\n\r\n        // 左右两边的点，高度居中\r\n        if (hasL || hasR) {\r\n            newLeft = hasL? 0 : width\r\n            newTop = Math.floor(height / 2)\r\n        }\r\n    }\r\n\r\n    const style = {\r\n        marginLeft: hasR? '-4px' : '-3px',\r\n        marginTop: '-3px',\r\n        left: `${newLeft}px`,\r\n        top: `${newTop}px`,\r\n        cursor: point.split('').reverse().map(m => directionKey[m]).join('') + '-resize',\r\n    }\r\n\r\n    return style\r\n}\r\n\r\nfunction Shape(props){\r\n    const dispatch = useDispatch();\r\n    const currentIndex = useSelector(state => state.MyReducer.currentIndex);\r\n    const handleMouseDown = useCallback(function (e) {\r\n        e.stopPropagation()\r\n        dispatch({\r\n            type:'setCurrentIndex',\r\n            index:props.index\r\n        })\r\n    \r\n        // const pos = { ...this.defaultStyle }\r\n        const startY = e.clientY\r\n        const startX = e.clientX\r\n        dispatch({\r\n            type:'updateStartPos',\r\n            pos:{\r\n                startY,\r\n                startX\r\n            }\r\n        })\r\n        // 如果直接修改属性，值的类型会变为字符串，所以要转为数值型\r\n        // const startTop = Number(pos.top)\r\n        // const startLeft = Number(pos.left)\r\n    \r\n        const move = (moveEvent) => {\r\n            const currX = moveEvent.clientX\r\n            const currY = moveEvent.clientY\r\n            // 修改当前组件样式\r\n            dispatch({\r\n                type:'updateMovePos',\r\n                pos:{\r\n                    currX,\r\n                    currY\r\n                }\r\n            })\r\n        }\r\n    \r\n        const up = () => {\r\n            document.removeEventListener('mousemove', move)\r\n            document.removeEventListener('mouseup', up)\r\n        }\r\n    \r\n        document.addEventListener('mousemove', move)\r\n        document.addEventListener('mouseup', up)\r\n    },[props.index])\r\n\r\n    const handleMouseDownOnPoint = useCallback(function (e,point,defaultStyle) {\r\n        const event = e;\r\n        event.stopPropagation()\r\n        event.preventDefault()\r\n\r\n\r\n        const pos = {...defaultStyle}\r\n        const height = Number(pos.height)\r\n        const width = Number(pos.width)\r\n        const top = Number(pos.top)\r\n        const left = Number(pos.left)\r\n        const startX = event.clientX\r\n        const startY = event.clientY \r\n    \r\n        // 是否需要保存快照\r\n        let needSave = false\r\n        const move = (moveEvent) => {\r\n            needSave = true\r\n            const currX = moveEvent.clientX\r\n            const currY = moveEvent.clientY\r\n            const disY = currY - startY\r\n            const disX = currX - startX\r\n            const hasT = /t/.test(point)\r\n            const hasB = /b/.test(point)\r\n            const hasL = /l/.test(point)\r\n            const hasR = /r/.test(point)\r\n            const newHeight = height + (hasT? -disY : hasB? disY : 0)\r\n            const newWidth = width + (hasL? -disX : hasR? disX : 0)\r\n            pos.height = newHeight > 0? newHeight : 0\r\n            pos.width = newWidth > 0? newWidth : 0\r\n            pos.left = left + (hasL? disX : 0)\r\n            pos.top = top + (hasT? disY : 0)\r\n            // console.log(pos);\r\n            dispatch({\r\n                type:'updateStyle',\r\n                pos:pos\r\n            })\r\n            // this.$store.commit('setShapeStyle', pos)\r\n        }\r\n    \r\n        const up = () => {\r\n            document.removeEventListener('mousemove', move)\r\n            document.removeEventListener('mouseup', up)\r\n            needSave && (\r\n                dispatch({\r\n                    type:'save'\r\n                })\r\n            )\r\n        }\r\n    \r\n        document.addEventListener('mousemove', move)\r\n        document.addEventListener('mouseup', up)\r\n    },[])\r\n\r\n    return (\r\n        <div \r\n            className={[css.shape,(currentIndex === props.index?css.active:null)].join(' ')}\r\n            onMouseDown={handleMouseDown}\r\n            style={props.style}\r\n        >\r\n            {(currentIndex === props.index && props.havePoint) && pointList.map((point,index)=>{\r\n                return (\r\n                    <div\r\n                        className={css.shapePoint}\r\n                        onMouseDown={(e)=>handleMouseDownOnPoint(e,point,props.style)}\r\n                        key={index}\r\n                        style={getPointStyle(point,props.style)}>\r\n                    </div>\r\n                )\r\n            })}\r\n            \r\n            {props.children}\r\n        </div>\r\n    )\r\n}\r\n\r\nconst leftToolBarWidth = 100;\r\nconst TopToolBarHeight = 50;\r\n\r\nfunction Drawer(){\r\n    const [menuIsShow,menuIsShowHandle] = useState(false);\r\n    const [menuPos,updateMenuPos] = useState({top:0,left:0});\r\n    const componentData = useSelector(state => state.MyReducer.renderList);\r\n    const dispatch = useDispatch();\r\n\r\n    const dropEndHandle = useCallback(function (e){\r\n        let index = e.dataTransfer.getData('index');\r\n        let compData = componentList[index];\r\n        let copyObj = JSON.parse(JSON.stringify(compData));\r\n        copyObj.key = Date.now();\r\n        \r\n        copyObj.style.top = e.clientY - TopToolBarHeight;\r\n        copyObj.style.left = e.clientX - leftToolBarWidth;\r\n\r\n        dispatch({\r\n            type:'AddComp',\r\n            comp:copyObj\r\n        })\r\n        dispatch({\r\n            type:'save'\r\n        })\r\n        // componentData.push(copyObj);\r\n        // setComponentData([...componentData])\r\n    },[])\r\n    \r\n    const handleContextMenu = useCallback(function (e) {\r\n        e.preventDefault();\r\n        updateMenuPos({\r\n            top:e.clientY - TopToolBarHeight,\r\n            left:e.clientX - leftToolBarWidth,\r\n        })\r\n        menuIsShowHandle(true);\r\n    },[])\r\n\r\n    const handleClick = useCallback(function (e) {\r\n        menuIsShowHandle(false);\r\n    },[])\r\n\r\n    const handleDownIndex = useCallback(function (e) {\r\n        dispatch({\r\n            type:'downIndex',\r\n        })\r\n    },[])\r\n\r\n    const handleSDownIndex = useCallback(function (e) {\r\n        dispatch({\r\n            type:'sdownIndex',\r\n        })\r\n    },[])\r\n\r\n    const handleUpIndex = useCallback(function (e) {\r\n        dispatch({\r\n            type:'upIndex',\r\n        })\r\n    },[])\r\n\r\n    const handleSUpIndex = useCallback(function (e) {\r\n        dispatch({\r\n            type:'supIndex',\r\n        })\r\n    },[])\r\n\r\n    const handleDelete = useCallback(function (e) {\r\n        dispatch({\r\n            type:'deleteComp',\r\n        })\r\n    },[])\r\n\r\n    return (\r\n        <div \r\n            onDrop={dropEndHandle} \r\n            onDragOver={dragOverHandle}\r\n            onDragStart={dragOverHandle}\r\n            draggable=\"true\" \r\n            onContextMenu={handleContextMenu}\r\n            onClick={handleClick}\r\n            className={css.main}\r\n        >\r\n            <div className={css.menuBox} style={{display:menuIsShow?'block':'none',...menuPos}}>\r\n                <div className={css.menuItem} onClick={handleSDownIndex}>置底</div>\r\n                <div className={css.menuItem} onClick={handleDownIndex}>下移</div>\r\n                <div className={css.menuItem} onClick={handleSUpIndex}>置顶</div>\r\n                <div className={css.menuItem} onClick={handleUpIndex}>上移</div>\r\n                <div className={css.menuItem} onClick={handleDelete}>删除</div>\r\n            </div>\r\n            {componentData.map((item,index)=>{\r\n                let DynamicComp = transformComp(item.component);\r\n                return (\r\n                    <Shape key={item.key} index={index} style={item.style} havePoint={item.havePoint}>\r\n                        <DynamicComp style={item.style} propV={item.propV}/>\r\n                    </Shape>\r\n                )\r\n                // return createElement(window[item.component],{\r\n                //     style: item.style,\r\n                //     key: item.key\r\n                // });\r\n            })}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Drawer;","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\component\\LeftToolBar\\index.js",[],"D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\component\\Header\\index.js",["47","48"],"import {useCallback} from 'react';\r\nimport {useDispatch} from 'react-redux'\r\n\r\nimport css from './index.module.css';\r\nfunction Header(){\r\n    const dispatch = useDispatch();\r\n    const undo = useCallback(function(){\r\n        dispatch({\r\n            type:'undo',\r\n        })\r\n    },[])\r\n\r\n    const redo = useCallback(function(){\r\n        dispatch({\r\n            type:'redo',\r\n        })\r\n    },[])\r\n\r\n    return (\r\n        <div className={css.header}>\r\n            <div className={css.btn} onClick={undo}>撤销</div>\r\n            <div className={css.btn} onClick={redo}>重做</div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Header","D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\store\\reducer\\renderReducer.js",[],"D:\\yong_workplace\\demo\\tools\\visual_build_demo\\src\\componentlist.js",[],{"ruleId":"49","replacedBy":"50"},{"ruleId":"51","replacedBy":"52"},{"ruleId":"53","severity":1,"message":"54","line":126,"column":7,"nodeType":"55","endLine":126,"endColumn":20,"suggestions":"56"},{"ruleId":"53","severity":1,"message":"54","line":180,"column":7,"nodeType":"55","endLine":180,"endColumn":9,"suggestions":"57"},{"ruleId":"53","severity":1,"message":"54","line":231,"column":7,"nodeType":"55","endLine":231,"endColumn":9,"suggestions":"58"},{"ruleId":"53","severity":1,"message":"54","line":250,"column":7,"nodeType":"55","endLine":250,"endColumn":9,"suggestions":"59"},{"ruleId":"53","severity":1,"message":"54","line":256,"column":7,"nodeType":"55","endLine":256,"endColumn":9,"suggestions":"60"},{"ruleId":"53","severity":1,"message":"54","line":262,"column":7,"nodeType":"55","endLine":262,"endColumn":9,"suggestions":"61"},{"ruleId":"53","severity":1,"message":"54","line":268,"column":7,"nodeType":"55","endLine":268,"endColumn":9,"suggestions":"62"},{"ruleId":"53","severity":1,"message":"54","line":274,"column":7,"nodeType":"55","endLine":274,"endColumn":9,"suggestions":"63"},{"ruleId":"53","severity":1,"message":"54","line":11,"column":7,"nodeType":"55","endLine":11,"endColumn":9,"suggestions":"64"},{"ruleId":"53","severity":1,"message":"54","line":17,"column":7,"nodeType":"55","endLine":17,"endColumn":9,"suggestions":"65"},"no-native-reassign",["66"],"no-negated-in-lhs",["67"],"react-hooks/exhaustive-deps","React Hook useCallback has a missing dependency: 'dispatch'. Either include it or remove the dependency array.","ArrayExpression",["68"],["69"],["70"],["71"],["72"],["73"],["74"],["75"],["76"],["77"],"no-global-assign","no-unsafe-negation",{"desc":"78","fix":"79"},{"desc":"80","fix":"81"},{"desc":"80","fix":"82"},{"desc":"80","fix":"83"},{"desc":"80","fix":"84"},{"desc":"80","fix":"85"},{"desc":"80","fix":"86"},{"desc":"80","fix":"87"},{"desc":"80","fix":"88"},{"desc":"80","fix":"89"},"Update the dependencies array to be: [dispatch, props.index]",{"range":"90","text":"91"},"Update the dependencies array to be: [dispatch]",{"range":"92","text":"93"},{"range":"94","text":"93"},{"range":"95","text":"93"},{"range":"96","text":"93"},{"range":"97","text":"93"},{"range":"98","text":"93"},{"range":"99","text":"93"},{"range":"100","text":"93"},{"range":"101","text":"93"},[3319,3332],"[dispatch, props.index]",[5202,5204],"[dispatch]",[6891,6893],[7391,7393],[7525,7527],[7653,7655],[7783,7785],[7913,7915],[281,283],[394,396]]